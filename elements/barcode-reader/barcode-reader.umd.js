!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("lit"),require("@lrnwebcomponents/es-global-bridge/es-global-bridge.js"),require("@lrnwebcomponents/simple-icon/lib/simple-icon-button.js")):"function"==typeof define&&define.amd?define(["exports","lit","@lrnwebcomponents/es-global-bridge/es-global-bridge.js","@lrnwebcomponents/simple-icon/lib/simple-icon-button.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).BarcodeReader={},e.lit)}(this,(function(e,t){"use strict";function n(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
n=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var o=t&&t.prototype instanceof h?t:h,i=Object.create(o.prototype),a=new L(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return j()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=_(a,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,a),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var d={};function h(){}function f(){}function p(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y(S([])));m&&m!==t&&r.call(m,i)&&(v=m);var w=p.prototype=h.prototype=Object.create(v);function g(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function n(o,i,a,c){var u=l(e[o],e,i);if("throw"!==u.type){var s=u.arg,d=s.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(d).then((function(e){s.value=e,a(s)}),(function(e){return n("throw",e,a,c)}))}c(u.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function _(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function S(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:j}}function j(){return{value:void 0,done:!0}}return f.prototype=p,u(w,"constructor",p),u(p,"constructor",f),f.displayName=u(p,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,u(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},g(b.prototype),u(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new b(s(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(w),u(w,c,"Generator"),u(w,i,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;E(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function r(e,t,n,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function c(e){r(a,o,i,c,u,"next",e)}function u(e){r(a,o,i,c,u,"throw",e)}c(void 0)}))}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=a(e);if(t){var o=a(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}function d(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var h,f,p,v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(g,e);var r,a,s,v,y,m,w=l(g);function g(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),(e=w.call(this)).value="",e.hideinput=!1,window.ESGlobalBridge.requestAvailability().load("ZXing",decodeURIComponent("undefined"==typeof document&&"undefined"==typeof location?new(require("url").URL)("file:"+__filename).href:"undefined"==typeof document?location.href:document.currentScript&&document.currentScript.src||new URL("barcode-reader.umd.js",document.baseURI).href)+"/../lib/zxing.js"),window.addEventListener("es-bridge-zxing-loaded",e._control.bind(u(e))),e}return r=g,a=[{key:"render",value:function(){return t.html(h||(h=d(['\n      <div class="hidden" hidden>\n        <div>\n          <video\n            muted\n            autoplay\n            playsinline\n            width="','%"\n            height="','%"\n          ></video>\n          <canvas style="display: none; float: bottom;"></canvas>\n        </div>\n      </div>\n      <div class="input" ?hidden="','">\n        Result: <span><input type="text" .value="','" /> </span>\n      </div>\n      <span>\n        <div class="hidden2" hidden>\n          <div class="select">\n            <label for="videoSource">Video source: </label>\n            <select></select>\n          </div>\n          <button class="go">Scan</button>\n        </div>\n        <simple-icon-button\n          aria-labelledby="label"\n          icon="image:camera-alt"\n          class="render"\n        ></simple-icon-button>\n        <label id="label">Initialize</label>\n      </span>\n    '])),this.scale,this.scale,this.hideinput,this.value)}},{key:"_control",value:function(){var e=this,t=this.shadowRoot.querySelector("video"),r=this.shadowRoot.querySelector("canvas"),i=r.getContext("2d"),a=this.shadowRoot.querySelector(".go"),c=!0,u=null,s=null;!function e(){window.ZXing?setTimeout((function(){console.log("loaded zxing instance"),u=new window.ZXing,s=u.Runtime.addFunction(b)}),100):setTimeout(e,100)}();var l,d,h,f,v,y,m,w,g,b=function(){var t=o(n().mark((function t(r,o,i,c){var s;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=new Uint8Array(u.HEAPU8.buffer,r,o),console.log(String.fromCharCode.apply(null,s)),e.value=String.fromCharCode.apply(null,s),a.removeAttribute("disabled");case 4:case"end":return t.stop()}}),t)})));return function(e,n,r,o){return t.apply(this,arguments)}}();function _(){if(null==u)return a.removeAttribute("disabled"),void alert("Barcode Reader is not ready!");var e=null,n=0,r=0;c?(e=i,n=640,r=480):(e=mobileCtx,n=240,r=320),e.drawImage(t,0,0,n,r);var o=document.createElement("canvas");o.width=p.videoWidth,o.height=p.videoHeight;var l=o.getContext("2d"),d=p.videoWidth,h=p.videoHeight;l.drawImage(t,0,0,d,h);var f=l.getImageData(0,0,d,h).data,v=u._resize(d,h);console.time("decode barcode");for(var y=0,m=0;y<f.length;y+=4,m++)u.HEAPU8[v+m]=f[y];var w=u._decode_any(s);console.timeEnd("decode barcode"),console.log(w),-2==w?setTimeout(_,30):-3==w?(console.error("error code: ",w),a.removeAttribute("disabled")):0===w&&a.removeAttribute("disabled")}c="pc"==(l=navigator.userAgent.toLowerCase(),d="ipad"==l.match(/ipad/i),h="iphone os"==l.match(/iphone os/i),f="midp"==l.match(/midp/i),v="rv:1.2.3.4"==l.match(/rv:1.2.3.4/i),y="ucweb"==l.match(/ucweb/i),m="android"==l.match(/android/i),w="windows ce"==l.match(/windows ce/i),g="windows mobile"==l.match(/windows mobile/i),d||h||f||v||y||m||w||g?"phone":"pc"),a.onclick=function(){console.log("click"),e.value="",r.style.display="none",a.setAttribute("disabled",""),_()};var x=this.shadowRoot.querySelector("select");function E(){a.removeAttribute("disabled"),window.stream&&window.stream.getTracks().forEach((function(e){e.stop()}));var e={video:{deviceId:{exact:x.value}}};navigator.mediaDevices.getUserMedia(e).then(L).catch(S)}function L(e){window.stream=e,t.srcObject=e}function S(e){console.error("Error: ",e)}navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=e.length-1;t>=0;--t){var n=e[t],r=document.createElement("option");r.value=n.deviceId,"videoinput"===n.kind?(r.text=n.label||"camera "+(x.length+1),x.appendChild(r)):console.log("Found one other kind of source/device: ",n)}})).then(E).catch(S),x.onchange=E,this.shadowRoot.querySelector(".render").addEventListener("click",(function(){if("Show"===e.shadowRoot.querySelector(".render").innerHTML&&window.stream){window.stream.getTracks().forEach((function(e){}));var t={video:{deviceId:{exact:x.value}}};navigator.mediaDevices.getUserMedia(t).then(L).catch(S)}}))}},{key:"updated",value:function(e){var t=this;e.forEach((function(e,n){"value"===n&&t.dispatchEvent(new CustomEvent("value-changed",{detail:t}))}))}},{key:"firstUpdated",value:function(){this.start().then((function(e){})),this.__context=this.shadowRoot.querySelector("canvas").getContext("2d"),this.__video=this.shadowRoot.querySelector("video"),this.__videoInputSelector=this.shadowRoot.querySelector("#videoInput"),p=this.shadowRoot.querySelector("video"),this._renderVideo().then((function(e){})),this.hideinput||this.shadowRoot.querySelector(".input").removeAttribute("hidden")}},{key:"_onFrame",value:(m=o(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.__video.videoWidth>0&&this._drawFrame(this.__video),this.__animationFrameId=requestAnimationFrame(this._onFrame.bind(this));case 2:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"_drawFrame",value:function(e){this.__context.drawImage(e,0,0,this.width,this.height,0,0,this.width,this.height)}},{key:"start",value:(y=o(n().mark((function e(){var t=this;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.shadowRoot.querySelector("simple-icon-button").addEventListener("click",(function(){"Initialize"===t.shadowRoot.querySelector(".render").innerHTML&&t._control()}));case 1:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"_renderVideo",value:(v=o(n().mark((function e(){var t,r,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.shadowRoot.querySelector(".hidden"),r=this.shadowRoot.querySelector("simple-icon-button"),o=this.shadowRoot.querySelector(".hidden2"),t.style.display="none",this.shadowRoot.querySelector("simple-icon-button").addEventListener("click",(function(){setTimeout((function(){"none"===t.style.display?(t.style.display="inline",r.innerHTML="Hide",o.style.display="inline"):(t.style.display="none",r.innerHTML="Show",o.style.display="none",window.stream.getTracks().forEach((function(e){e.stop()})))}),100)}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})}],s=[{key:"styles",get:function(){return t.css(f||(f=d(["\n      :host([hidden]) {\n        display: none;\n      }\n      canvas {\n        display: none;\n      }\n      video {\n        border-style: solid;\n        border-color: rgba(0, 0, 0, 0.5);\n        border-width: 5px;\n      }\n    "])))}},{key:"properties",get:function(){return{value:{type:String,reflect:!0},scale:{type:Number,reflect:!0},hideinput:{type:Boolean}}}},{key:"tag",get:function(){return"barcode-reader"}}],a&&i(r.prototype,a),s&&i(r,s),Object.defineProperty(r,"prototype",{writable:!1}),g}(t.LitElement);customElements.define(v.tag,v),e.BarcodeReader=v,Object.defineProperty(e,"__esModule",{value:!0})}));
