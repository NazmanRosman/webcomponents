!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("lit"),require("@lrnwebcomponents/es-global-bridge/es-global-bridge.js"),require("@lrnwebcomponents/super-daemon/lib/super-daemon-toast.js")):"function"==typeof define&&define.amd?define(["exports","lit","@lrnwebcomponents/es-global-bridge/es-global-bridge.js","@lrnwebcomponents/super-daemon/lib/super-daemon-toast.js"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).Hal9000={},e.lit)}(this,(function(e,n){"use strict";function t(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function r(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,p(o.key),o)}}function a(e,n,t){return(n=p(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}function s(e,n){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},s(e,n)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,n){if(n&&("object"==typeof n||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}function l(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,o=i(e);if(n){var r=i(this).constructor;t=Reflect.construct(o,arguments,r)}else t=o.apply(this,arguments);return c(this,t)}}function d(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=i(e)););return e}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,n,t){var o=d(e,n);if(o){var r=Object.getOwnPropertyDescriptor(o,n);return r.get?r.get.call(arguments.length<3?e:t):r.value}},f.apply(this,arguments)}function p(e){var n=function(e,n){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,n||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:String(n)}var y=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&s(e,n)}(y,e);var n,c,d,p=l(y);function y(){var e;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,y),(e=p.call(this)).toast=!1,e.windowControllers=new AbortController,e.commands={},e.respondsTo="(merlin)",e.debug=!1,e.pitch=.9,e.rate=.9,e.language=navigator.language,window.Hal9000=window.Hal9000||{},window.Hal9000.instance=u(e);var n="".concat(new URL("./lib/annyang/annyang.min.js","undefined"==typeof document&&void 0===n?new(require("url").URL)("file:"+__filename).href:"undefined"==typeof document?n.href:document.currentScript&&document.currentScript.src||new URL("hal-9000.umd.js",document.baseURI).href).href);if(window.addEventListener("es-bridge-annyang-loaded",e._annyangLoaded.bind(u(e)),{signal:e.windowControllers.signal}),window.ESGlobalBridge.requestAvailability().load("annyang",n),void 0!==window.speechSynthesis){e.synth=window.speechSynthesis,e.voices=e.synth.getVoices();for(var t=0;t<e.voices.length;t++)e.voices[t].default&&(e.defaultVoice=e.voices[t].name)}return e}return n=y,c=[{key:"_commandsChanged",value:function(e){this.addCommands(e)}},{key:"addCommands",value:function(e){if(this.annyang){if(this.annyang.removeCommands(),e["*anything"]){var n=e["*anything"];delete e["*anything"],e["*anything"]=n}this.annyang.addCommands(e)}}},{key:"speak",value:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new Promise((function(r){n.__text=e,n.synth?(n.utter=new SpeechSynthesisUtterance(n.__text),n.utter.pitch=n.pitch,n.utter.rate=n.rate,n.utter.lang=n.language,n.utter.voice=n.defaultVoice,window.HAXCMS&&(window.HAXCMS.instance.setCursor("hax:wizard-hat"),window.HAXCMS.instance.setFavicon("hax:wizard-hat")),n.synth.speak(n.utter),n.toast&&n.setToast(e,t,o),n.utter.onend=function(e){window.HAXCMS&&(window.HAXCMS.instance.resetCursor(),window.HAXCMS.instance.resetFavicon()),t||o||window.dispatchEvent(new CustomEvent("super-daemon-toast-hide",{bubbles:!0,composed:!0,cancelable:!1,detail:!1})),r(e)}):r(!1)}))}},{key:"setToast",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];window.dispatchEvent(new CustomEvent("super-daemon-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:e,future:!0,merlin:!0,accentColor:"purple",duration:4e3,alwaysvisible:n,awaitingMerlinInput:t}}))}},{key:"_annyangLoaded",value:function(){if(this.annyang=window.annyang,this.annyang){this.annyang.addCommands(this.commands),this.annyang.debug(this.debug),this.auto?this.annyang.start({autoRestart:!0,continuous:!0}):this.enabled&&this.annyang.start();var e=new CustomEvent("hal-9000-online",{bubbles:!0,cancelable:!1,detail:!0});this.dispatchEvent(e)}}},{key:"_respondsToChanged",value:function(e,n){this.annyang&&this.annyang.removeCommands();var o={};for(var r in this.commands)r.replace(n,e)!==r?o[r.replace(n,e)]=this.commands[r]:o[r]=this.commands[r];o.length>0&&(this.commands=function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach((function(n){a(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}({},o))}},{key:"_autoChanged",value:function(e){this.enabled=e}},{key:"_enabledChanged",value:function(e){this.annyang&&(e?this.auto?this.annyang.start({autoRestart:!0,continuous:!0}):this.annyang.start():this.annyang.abort())}},{key:"_debugChanged",value:function(e,n){this.annyang&&this.annyang.debug(e)}},{key:"updated",value:function(e){var n=this;e.forEach((function(e,t){"commands"==t&&"undefined"!==o(e)&&n._commandsChanged(n[t]),"respondsTo"==t&&n._respondsToChanged(n[t],e),"debug"==t&&n._debugChanged(n[t],e),"auto"==t&&n._autoChanged(n[t],e),"enabled"==t&&n._enabledChanged(n[t],e)}))}},{key:"disconnectedCallback",value:function(){this.windowControllers.abort(),f(i(y.prototype),"disconnectedCallback",this).call(this)}}],d=[{key:"properties",get:function(){return{toast:{type:Boolean,reflect:!0},commands:{name:"commands",type:Object},respondsTo:{name:"respondsTo",type:String,attribute:"responds-to"},debug:{name:"debug",type:Boolean},auto:{name:"auto",type:Boolean,reflect:!0},enabled:{name:"enabled",type:Boolean,reflect:!0},pitch:{name:"pitch",type:Number,reflect:!0},rate:{name:"rate",type:Number,reflect:!0},language:{name:"language",type:String,reflect:!0}}}},{key:"tag",get:function(){return"hal-9000"}}],c&&r(n.prototype,c),d&&r(n,d),Object.defineProperty(n,"prototype",{writable:!1}),y}(n.LitElement);customElements.define(y.tag,y),window.Hal9000=window.Hal9000||{},window.Hal9000.requestAvailability=function(){if(!window.Hal9000.instance){var e=document.createElement("hal-9000");document.body.appendChild(e),window.Hal9000.instance=e}return window.Hal9000.instance};var b=window.Hal9000.requestAvailability();e.HAL9000Instance=b,e.Hal9000=y,Object.defineProperty(e,"__esModule",{value:!0})}));
