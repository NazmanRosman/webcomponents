!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("lit"),require("@lrnwebcomponents/simple-colors/simple-colors.js"),require("@lrnwebcomponents/absolute-position-behavior/absolute-position-behavior.js"),require("@lrnwebcomponents/simple-icon/lib/simple-icon-button.js"),require("@lrnwebcomponents/simple-icon/lib/simple-icons.js"),require("@lrnwebcomponents/rpg-character/rpg-character.js"),require("@lrnwebcomponents/simple-datetime/simple-datetime.js"),require("@lrnwebcomponents/simple-fields/lib/simple-fields-field.js"),require("@lrnwebcomponents/simple-picker/lib/simple-emoji-picker.js")):"function"==typeof define&&define.amd?define(["exports","lit","@lrnwebcomponents/simple-colors/simple-colors.js","@lrnwebcomponents/absolute-position-behavior/absolute-position-behavior.js","@lrnwebcomponents/simple-icon/lib/simple-icon-button.js","@lrnwebcomponents/simple-icon/lib/simple-icons.js","@lrnwebcomponents/rpg-character/rpg-character.js","@lrnwebcomponents/simple-datetime/simple-datetime.js","@lrnwebcomponents/simple-fields/lib/simple-fields-field.js","@lrnwebcomponents/simple-picker/lib/simple-emoji-picker.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).PageFlag={},e.lit,e.simpleColors_js)}(this,(function(e,t,n){"use strict";function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,x(o.key),o)}}function l(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return(t=x(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function f(e,t,n){return f=u()?Reflect.construct.bind():function(e,t,n){var o=[null];o.push.apply(o,t);var i=new(Function.bind.apply(e,o));return n&&p(i,n.prototype),i},f.apply(null,arguments)}function m(e){var t="function"==typeof Map?new Map:void 0;return m=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return f(e,arguments,d(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),p(o,e)},m(e)}function h(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function b(e){var t=u();return function(){var n,o=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return h(this,n)}}function y(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}function g(){return g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var o=y(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},g.apply(this,arguments)}function v(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function w(e){return function(e){if(Array.isArray(e))return _(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function x(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var j,k,O,E,M,S,P,R,U,q=function(e){c(o,e);var n=b(o);function o(){var e;return r(this,o),(e=n.call(this)).mood=null,e.seed="abc123",e.timestamp=Date.now()/1e3,e.reply=0,e.editMode=!1,e.canEdit=!1,e.readOnly=!0,e.haxUIElement=!0,e}return l(o,[{key:"testCanUpdate",value:function(e){this.seed===e?this.canEdit=!0:this.canEdit=!1}},{key:"deleteOp",value:function(){this.dispatchEvent(new CustomEvent("page-flag-comment-delete",{bubbles:!0,cancelable:!0,detail:this}))}},{key:"replyOp",value:function(){this.dispatchEvent(new CustomEvent("page-flag-comment-reply",{bubbles:!0,cancelable:!0,detail:this}))}},{key:"editOp",value:function(){this.dispatchEvent(new CustomEvent("page-flag-comment-edit",{bubbles:!0,cancelable:!0,detail:this}))}},{key:"render",value:function(){return t.html(j||(j=v(['\n      <div class="comment">\n      ','\n        <div class="comment__header">\n          <div class="comment__header__avatar">\n          <rpg-character\n              seed="','"\n              width="40"\n              height="40"\n              hat="','"\n            ></rpg-character>\n          </div>\n          <div class="comment__header__info">\n            <div class="comment__header__info__name">','</div>\n            <div class="comment__header__info__date">\n            <simple-datetime\n                format="m/j/y h:i"\n                .timestamp="','"\n                unix\n            ></simple-datetime></div>\n          </div>\n        </div>\n        <div class="comment__body">\n            <simple-fields-field type="textarea"></simple-fields-field>\n            <slot></slot>\n        </div>\n        <div class="comment__footer">\n          <div class="comment__footer__actions">\n            ',"\n          </div>\n        </div>\n      </div>\n    "])),this.editMode?t.html(k||(k=v(['<simple-emoji-picker align-right label="Reaction" value="','" @value-changed="','"></simple-emoji-picker>'])),this.mood,this.emojiChanged):t.html(O||(O=v(['<div class="emoji" .innerHTML="','"></div>'])),this.mood),this.seed,this.editMode?"edit":"none",this.seed,this.timestamp,this.readOnly?"":t.html(E||(E=v(["\n            ",'\n            <simple-icon-button icon="reply" title="Reply" @click="','"></simple-icon-button>\n            ',"\n            "])),this.canEdit?t.html(M||(M=v(['<simple-icon-button icon="','" title="','" @click="','"></simple-icon-button>\n'])),this.editMode?"save":"editor:mode-edit",this.editMode?"Edit":"Update",this.editOp):"",this.replyOp,this.canEdit?t.html(S||(S=v(['<simple-icon-button icon="delete" title="Delete" @click="','"></simple-icon-button>'])),this.deleteOp):""))}},{key:"emojiChanged",value:function(e){this.mood=e.detail.value}},{key:"firstUpdated",value:function(e){g(d(o.prototype),"firstUpdated",this).call(this,e),this.shadowRoot.querySelector("simple-fields-field").value=this.innerHTML}},{key:"updated",value:function(e){var t=this;g(d(o.prototype),"updated",this).call(this,e),e.forEach((function(e,n){"editMode"==n&&void 0!==e&&(t[n]?(t.shadowRoot.querySelector("simple-fields-field").value=t.innerHTML,setTimeout((function(){t.shadowRoot.querySelector("simple-fields-field").focus(),t.shadowRoot.querySelector("simple-fields-field").select()}),0)):t.innerHTML=t.shadowRoot.querySelector("simple-fields-field").value)}))}}],[{key:"tag",get:function(){return"page-flag-comment"}},{key:"properties",get:function(){return{seed:{type:String},timestamp:{type:Number},mood:{type:String},editMode:{type:Boolean,reflect:!0,attribute:"edit-mode"},canEdit:{type:Boolean},reply:{type:Number,reflect:!0},readOnly:{type:Boolean}}}},{key:"styles",get:function(){return[,t.css(P||(P=v(['\n      :host {\n        display: block;\n      }\n      :host slot {\n        display: block;\n      }\n      :host simple-emoji-picker,\n      :host simple-fields-field {\n        display: none;\n      }\n      :host([edit-mode]) simple-emoji-picker,\n      :host([edit-mode]) simple-fields-field {\n        display: block;\n      }\n      simple-emoji-picker {\n        float: right;\n        width: 40px;\n      }\n      .emoji {\n        float: right;\n        width: 40px;\n        height: 40px;\n        font-size: 32px;\n      }\n      :host([edit-mode]) slot {\n        display: none;\n      }\n      :host([reply="1"]) .comment {\n        margin-left: 16px;\n      }\n      :host([reply="2"]) .comment {\n        margin-left: 32px;\n      }\n      .comment {\n        background-color: #fff;\n        border-radius: 5px;\n        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);\n        padding: 10px;\n        margin-bottom: 10px;\n      }\n      simple-icon-button {\n        --simple-icon-height: 16px;\n        --simple-icon-width: 16px;\n        margin: 0 6px;\n      }\n      .comment__header {\n        display: flex;\n        align-items: center;\n        margin-bottom: 10px;\n      }\n      .comment__header__avatar {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        overflow: hidden;\n        border: 2px solid black;\n        margin-right: 8px;\n      }\n      .comment__header__info {\n        display: flex;\n        flex-direction: column;\n      }\n      .comment__header__info__name {\n        font-weight: bold;\n        font-size: 14px;\n      }\n      .comment__header__info__date {\n        font-size: 12px;\n        color: #999;\n      }\n      .comment__body {\n        margin-bottom: 10px;\n      }\n      .comment__footer {\n        display: flex;\n        justify-content: flex-end;\n      }\n      .comment__footer__actions {\n        display: flex;\n      }\n      .comment__footer__actions__button {\n        background-color: transparent;\n        border: none;\n        color: #999;\n        font-size: 12px;\n        cursor: pointer;\n        margin-left: 10px;\n      }\n    '])))]}}]),o}(t.LitElement);customElements.define(q.tag,q);var C=function(e){c(o,e);var n=b(o);function o(){var e;return r(this,o),(e=n.call(this)).label="note",e.opened=!1,e.accentColor="cyan",e.show=!1,e._haxState=!1,e}return l(o,[{key:"toggleOpen",value:function(e){var t=this;this.opened=!this.opened,this.dark=this.opened,this.querySelectorAll("page-flag-comment").forEach((function(e){e.testCanUpdate(F.activeUser),e.readOnly=!t._haxState}))}},{key:"render",value:function(){return t.html(R||(R=v(['\n      <button class="arrow" @click="','">','</button>\n      <absolute-position-behavior\n        justify\n        position="bottom"\n        allow-overlap\n        auto\n        ?hidden="','"\n      >\n        <div\n          @page-flag-comment-edit="','"\n          @page-flag-comment-delete="','"\n          @page-flag-comment-reply="','"\n        >\n          <slot></slot>\n        </div>\n      </absolute-position-behavior>'])),this.toggleOpen,this.label,!this.opened,this.handleEdit,this.handleDelete,this.handleReply)}},{key:"handleEdit",value:function(e){e.detail.editMode=!e.detail.editMode}},{key:"handleDelete",value:function(e){e.detail.remove(),0===this.querySelectorAll("page-flag-comment").length&&this.remove()}},{key:"handleReply",value:function(e){var t=document.createElement("page-flag-comment");t.seed=F.activeUser,t.timestamp=Date.now()/1e3,t.canEdit=!0,t.readOnly=!1,t.reply=e.detail.reply+1<2?e.detail.reply+1:2,e.detail.insertAdjacentElement("afterend",t),setTimeout((function(){t.editMode=!0}),0)}},{key:"haxeditModeChanged",value:function(e){this.show=e,this._haxState=e}},{key:"haxHooks",value:function(){return{editModeChanged:"haxeditModeChanged",inlineContextMenu:"haxinlineContextMenu"}}},{key:"haxinlineContextMenu",value:function(e){e.ceButtons=[{icon:"lrn:discuss",callback:"haxResolveThread",label:"Resolve thread"}]}},{key:"haxResolveThread",value:function(e){return this.remove(),!0}},{key:"firstUpdated",value:function(e){if(g(d(o.prototype),"firstUpdated",this)&&g(d(o.prototype),"firstUpdated",this).call(this,e),F.allFlags.push(this),F.activeUser?this.show=!0:this.remove(),this.shadowRoot.querySelector("absolute-position-behavior").target=this.shadowRoot.querySelector(".arrow"),!this.querySelector("page-flag-comment")){var t=document.createElement("page-flag-comment");t.seed=F.activeUser,t.timestamp=Date.now()/1e3,t.canEdit=!0,t.readOnly=!1,this.appendChild(t),setTimeout((function(){t.editMode=!0}),100)}}}],[{key:"properties",get:function(){return i(i({},g(d(o),"properties",this)),{},{label:{type:String},opened:{type:Boolean,reflect:!0},show:{type:Boolean,reflect:!0}})}},{key:"styles",get:function(){var e=[];return g(d(o),"styles",this)&&(e=g(d(o),"styles",this)),[].concat(w(e),[t.css(U||(U=v(['\n        :host {\n          display: none;\n          float: right;\n          margin-right: -80px;\n        }\n        :host([show]) {\n          display: block;\n        }\n        .arrow {\n          border: 3px solid var(--simple-colors-default-theme-accent-4,#97d4e8);\n          border-radius: 4px;\n          background: var(--simple-colors-default-theme-accent-1,#c8e7f1);\n          color: var(--simple-colors-default-theme-accent-8,#2d7187);\n          padding: 8px;\n          text-align: center;\n          max-width: 100px;\n          font-size: 11px;\n          font-weight: bold;\n          position: relative;\n          cursor: pointer;\n        }\n        \n        .arrow::after, .arrow::before {\n          border: solid transparent;\n          content: " ";\n          display: block;\n          height: 0;\n          position: absolute;\n          pointer-events: none;\n          width: 0;\n          right: 100%;\n        }\n        .arrow::before {\n          border-color: rgba(255, 255, 255, 0);\n          border-right-color: var(--simple-colors-default-theme-accent-4,#97d4e8);\n          top: 50%;\n          margin-top: -14px;\n          border-width: 14px;\n        }\n        .arrow::after {\n          border-color: rgba(255, 255, 255, 0);\n          border-right-color: var(--simple-colors-default-theme-accent-1,#c8e7f1);\n          top: 50%;\n          margin-top: -10px;\n          border-width: 10px;\n        }\n        absolute-position-behavior {\n          z-index: var(--simple-modal-z-index, 1000);\n          min-width: 280px;\n        }\n        absolute-position-behavior div {\n          color: black;\n          background-color: white;\n          font-size: 12px;\n          width: 300px;\n          margin-left: 160px;\n          padding-top: 8px;\n        }\n      '])))])}},{key:"tag",get:function(){return"page-flag"}},{key:"haxProperties",get:function(){return new URL("./lib/".concat(this.tag,".haxProperties.json"),"undefined"==typeof document&&"undefined"==typeof location?new(require("url").URL)("file:"+__filename).href:"undefined"==typeof document?location.href:document.currentScript&&document.currentScript.src||new URL("page-flag.umd.js",document.baseURI).href).href}}]),o}(n.SimpleColors);customElements.define(C.tag,C);var T=function(e){c(n,e);var t=b(n);function n(){var e;return r(this,n),(e=t.call(this)).activeUser=null,e.allFlags=[],e}return l(n,[{key:"connectedCallback",value:function(){window.addEventListener("haxcms-user-data-updated",this.userDataUpdated.bind(this))}},{key:"disconnectedCallback",value:function(){window.removeEventListener("haxcms-user-data-updated",this.userDataUpdated.bind(this))}},{key:"userDataUpdated",value:function(e){this.activeUser=e.detail.userName,this.allFlags.forEach((function(e){e.show=!0}))}}],[{key:"tag",get:function(){return"page-flag-manager"}}]),n}(m(HTMLElement));customElements.define(T.tag,T),window.pageFlagManager=window.pageFlagManager||{},window.pageFlagManager.requestAvailability=function(){return window.pageFlagManager.instance||(window.pageFlagManager.instance=document.createElement(T.tag),document.body.appendChild(window.pageFlagManager.instance)),window.pageFlagManager.instance};var F=window.pageFlagManager.requestAvailability();e.PageFlag=C,e.pageFlagManager=F,e.pageFlagManagerEl=T,Object.defineProperty(e,"__esModule",{value:!0})}));
